class StrixK9Player{constructor(e,t){this.container=document.querySelector(e),this.videoConfig=t.video||{default:"",quality:[],source:{}},this.drmConfig=t.video?.drm||{enabled:!1},this.subtitleConfig=t.video?.subtitles||{enabled:!1,default:"off",tracks:[]},"string"==typeof this.videoConfig.playerLogo&&(this.videoConfig.playerLogo={src:this.videoConfig.playerLogo}),this.currentQuality="auto",this.currentSubtitle="off",this.subtitlesEnabled=this.subtitleConfig.enabled,this.mediaKeys=null,this.keySystemAccess=null,this.isDragging=t.dragging||!1,this.isVolumeDragging=t.volumeDragging||!1,this.volumeUpdatePending=!1,this.volumeUpdatePending=!1,this.isMuted=t.muted||!1,this.lastVolume=t.lastVolume||.5,this.previewEnabled=t.previewEnabled||!1,this.thumbnailPreview=t.thumbnailPreview||!1,this.currentHoverTime=t.currentHoverTime||0,this.isGeneratingPreview=t.isGeneratingPreview||!1,this.lastPreviewTime=t.lastPreviewTime||-1,this.previewThrottle=t.previewThrottle||null,this.preload=t.preload||"auto",this.loop=t.loop||!1,this.autoplay=t.autoplay||!1,this.theme=t.theme||{color:"#ff0000"},this.isVideoStarted=!1,this.originalVolume=1,this.hoverPreviewTimeout=null,this.init()}init(){this.createPlayer(),this.setupEventListeners(),this.applyStyles(),this.setupAutoCleanup(),this.drmConfig.enabled&&this.initializeDRM()}createPlayer(){const e=this.generateQualityOptions();this.playerHTML=`\n                    <div class="video-player-container">\n                    ${this.videoConfig.playerTitle?`<div class="player-title">${this.videoConfig.playerTitle}</div>`:""}\n                        <video class="main-video" preload="${this.preload}" ${this.autoplay?"autoplay":""} ${this.loop?"loop":""} ${this.videoConfig.poster?`poster="${this.videoConfig.poster}"`:""}>\n                            ${this.generateVideoSources()}\n                            Your browser does not support the video tag.\n                        </video>\n                        \n                        ${this.videoConfig.playerLogo&&this.videoConfig.playerLogo.src?this.generateLogoHTML():""}\n                        \n                        \x3c!-- Thumbnail Overlay --\x3e\n                        <div class="thumbnail-overlay" style="display: ${this.videoConfig.poster&&!this.autoplay?"flex":"none"}">\n                            <button class="thumbnail-play-btn">\n                                <i class="fas fa-play"></i>\n                            </button>\n                        </div>\n\n                        \x3c!-- Glowing Click Overlay --\x3e\n                        <div class="video-click-overlay">\n                            <i class="fas fa-play"></i>\n                        </div>\n\n                        \x3c!-- Loading Spinner Overlay --\x3e\n                        <div class="loading-spinner-overlay" style="display: none;">\n                            <div class="loading-spinner">\n                                <div class="spinner-ring"></div>\n                                <div class="spinner-text">Loading...</div>\n                            </div>\n                        </div>\n\n                        <div class="video-controls">\n                            <div class="progress-container">\n                                <div class="progress-bar">\n                                    <div class="progress"></div>\n                                    <div class="progress-handle"></div>\n                                </div>\n                                <div class="preview-container">\n                                    <div class="preview-thumbnail">\n                                        <canvas class="preview-canvas"></canvas>\n                                    </div>\n                                    <div class="preview-time">0:00</div>\n                                </div>\n                            </div>\n                            \n                            <div class="control-buttons">\n                                \x3c!-- Essential Controls Wrapper (Play + Volume) --\x3e\n                                <div class="essential-controls-wrapper">\n                                    <div class="control-group essential-controls">\n                                        <button class="control-btn play-pause">\n                                            <i class="fas fa-play"></i>\n                                        </button>\n                                    </div>\n                                    \n                                    <div class="control-group essential-controls">\n                                        <button class="control-btn volume-btn">\n                                            <i class="fas fa-volume-up"></i>\n                                        </button>\n                                        <div class="volume-container">\n                                            <div class="volume-slider">\n                                                <div class="volume-level"></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                \x3c!-- Desktop timestamp (Hidden on Mobile) --\x3e\n                                <div class="control-group essential-controls time-group desktop-time">\n                                    <span class="time-display">0:00 / 0:00</span>\n                                </div>\n                                \n                                <div class="control-spacer"></div>\n                                \n                                \x3c!-- Desktop Controls (Hidden on Mobile) --\x3e\n                                <div class="control-group desktop-controls">\n                                    <div class="selector-container" data-tooltip="Playback Speed">\n                                        <select class="speed-selector" aria-label="Select playback speed">\n                                            <option value="0.25">0.25x</option>\n                                            <option value="0.5">0.5x</option>\n                                            <option value="0.75">0.75x</option>\n                                            <option value="1" selected>Normal</option>\n                                            <option value="1.25">1.25x</option>\n                                            <option value="1.5">1.5x</option>\n                                            <option value="1.75">1.75x</option>\n                                            <option value="2">2x</option>\n                                        </select>\n                                    </div>\n                                    <div class="selector-container" data-tooltip="Video Quality">\n                                        <select class="quality-selector" aria-label="Select video quality">\n                                            ${e}\n                                        </select>\n                                    </div>\n                                    ${this.subtitleConfig.enabled?`\n                                    <div class="selector-container" data-tooltip="Subtitles">\n                                        <select class="subtitle-selector" aria-label="Select subtitles">\n                                            ${this.generateSubtitleOptions()}\n                                        </select>\n                                    </div>`:""}\n                                    <button class="control-btn loop-btn" data-tooltip="Loop">\n                                        <i class="fas fa-repeat"></i>\n                                    </button>\n                                    <button class="control-btn pip-btn">\n                                        <i class="fas fa-external-link-alt"></i>\n                                    </button>\n                                    <button class="control-btn theater-btn">\n                                        <i class="fas fa-tv"></i>\n                                    </button>\n                                    <button class="control-btn fullscreen-btn">\n                                        <i class="fas fa-expand"></i>\n                                    </button>\n                                </div>\n                                \n                                \x3c!-- Mobile Menu Toggle with Timestamp (Visible on Mobile) --\x3e\n                                <div class="control-group mobile-menu-toggle">\n                                    <span class="time-display mobile-time">0:00 / 0:00</span>\n                                    <button class="control-btn menu-toggle-btn" data-tooltip="More Options">\n                                        <i class="fas fa-ellipsis-v"></i>\n                                    </button>\n                                </div>\n                            </div>\n                            \n                            \x3c!-- Mobile Menu Backdrop --\x3e\n                            <div class="mobile-menu-backdrop"></div>\n                            \n                            \x3c!-- Mobile Dropdown Menu --\x3e\n                            <div class="mobile-controls-menu">\n                                <div class="mobile-menu-content">\n                                    <div class="mobile-control-row">\n                                        <label>Speed:</label>\n                                        <select class="mobile-speed-selector" aria-label="Select playback speed">\n                                            <option value="0.25">0.25x</option>\n                                            <option value="0.5">0.5x</option>\n                                            <option value="0.75">0.75x</option>\n                                            <option value="1" selected>Normal</option>\n                                            <option value="1.25">1.25x</option>\n                                            <option value="1.5">1.5x</option>\n                                            <option value="1.75">1.75x</option>\n                                            <option value="2">2x</option>\n                                        </select>\n                                    </div>\n                                    <div class="mobile-control-row">\n                                        <label>Quality:</label>\n                                        <select class="mobile-quality-selector" aria-label="Select video quality">\n                                            ${e}\n                                        </select>\n                                    </div>\n                                    ${this.subtitleConfig.enabled?`\n                                    <div class="mobile-control-row">\n                                        <label>Subtitles:</label>\n                                        <select class="mobile-subtitle-selector" aria-label="Select subtitles">\n                                            ${this.generateSubtitleOptions()}\n                                        </select>\n                                    </div>`:""}\n                                    <div class="mobile-control-row mobile-buttons">\n                                        <button class="mobile-control-btn mobile-loop-btn">\n                                            <i class="fas fa-repeat"></i>\n                                            <span>Loop</span>\n                                        </button>\n                                        <button class="mobile-control-btn mobile-pip-btn">\n                                            <i class="fas fa-external-link-alt"></i>\n                                            <span>PiP</span>\n                                        </button>\n                                        <button class="mobile-control-btn mobile-theater-btn">\n                                            <i class="fas fa-tv"></i>\n                                            <span>Theater</span>\n                                        </button>\n                                        <button class="mobile-control-btn mobile-fullscreen-btn">\n                                            <i class="fas fa-expand"></i>\n                                            <span>Fullscreen</span>\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `,this.container.innerHTML=this.playerHTML,this.thumbnailPreview||this.container.classList.add("thumbnails-disabled"),this.video=this.container.querySelector(".main-video"),this.playPauseBtn=this.container.querySelector(".play-pause"),this.volumeBtn=this.container.querySelector(".volume-btn"),this.volumeSlider=this.container.querySelector(".volume-slider"),this.volumeLevel=this.container.querySelector(".volume-level"),this.progressBar=this.container.querySelector(".progress"),this.progressContainer=this.container.querySelector(".progress-container"),this.progressHandle=this.container.querySelector(".progress-handle"),this.previewContainer=this.container.querySelector(".preview-container"),this.previewThumbnail=this.container.querySelector(".preview-thumbnail"),this.previewTime=this.container.querySelector(".preview-time"),this.timeDisplay=this.container.querySelector(".time-display"),this.mobileTimeDisplay=this.container.querySelector(".mobile-time"),this.fullscreenBtn=this.container.querySelector(".fullscreen-btn"),this.pipBtn=this.container.querySelector(".pip-btn"),this.theaterBtn=this.container.querySelector(".theater-btn"),this.loopBtn=this.container.querySelector(".loop-btn"),this.qualitySelector=this.container.querySelector(".quality-selector"),this.speedSelector=this.container.querySelector(".speed-selector"),this.subtitleSelector=this.container.querySelector(".subtitle-selector"),this.playerContainer=this.container.querySelector(".video-player-container"),this.menuToggleBtn=this.container.querySelector(".menu-toggle-btn"),this.mobileMenuBackdrop=this.container.querySelector(".mobile-menu-backdrop"),this.mobileControlsMenu=this.container.querySelector(".mobile-controls-menu"),this.mobileSpeedSelector=this.container.querySelector(".mobile-speed-selector"),this.mobileQualitySelector=this.container.querySelector(".mobile-quality-selector"),this.mobileSubtitleSelector=this.container.querySelector(".mobile-subtitle-selector"),this.mobileLoopBtn=this.container.querySelector(".mobile-loop-btn"),this.mobilePipBtn=this.container.querySelector(".mobile-pip-btn"),this.mobileTheaterBtn=this.container.querySelector(".mobile-theater-btn"),this.mobileFullscreenBtn=this.container.querySelector(".mobile-fullscreen-btn"),this.thumbnailOverlay=this.container.querySelector(".thumbnail-overlay"),this.thumbnailPlayBtn=this.container.querySelector(".thumbnail-play-btn"),this.videoClickOverlay=this.container.querySelector(".video-click-overlay"),this.loadingSpinnerOverlay=this.container.querySelector(".loading-spinner-overlay"),this.loadingSpinner=this.container.querySelector(".loading-spinner"),this.spinnerText=this.container.querySelector(".spinner-text"),this.previewCanvas=document.createElement("canvas"),this.previewCtx=this.previewCanvas.getContext("2d"),this.previewCanvas.width=160,this.previewCanvas.height=90,this.setupResizeObserver()}generateVideoSources(){let e=`<source src="${this.videoConfig.default||this.getHighestQualitySource()}" type="video/mp4">`;return this.subtitleConfig.enabled&&this.subtitleConfig.tracks.length>0&&this.subtitleConfig.tracks.forEach((t=>{const n=t.default?"default":"";e+=`\n<track kind="${t.kind||"subtitles"}" src="${t.src}" srclang="${t.srclang}" label="${t.label}" ${n}>`})),e}generateQualityOptions(){let e='<option value="auto" selected>Auto Quality</option>';return this.videoConfig.quality.forEach((t=>{this.videoConfig.source[t]&&(e+=`<option value="${t}">${t}</option>`)})),e}generateSubtitleOptions(){let e='<option value="off" selected>Off</option>';return this.subtitleConfig.tracks.forEach((t=>{const n=t.default?"selected":"";e+=`<option value="${t.srclang}" ${n}>${t.label}</option>`})),e}setupResizeObserver(){window.ResizeObserver?(this.resizeObserver=new ResizeObserver((e=>{for(let t of e)clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.checkVideoContainerWidth()}),100)})),this.resizeObserver.observe(this.container)):window.addEventListener("resize",(()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.checkVideoContainerWidth()}),100)})),setTimeout((()=>{this.checkVideoContainerWidth()}),100)}getHighestQualitySource(){const e=this.videoConfig.quality;for(let t of e)if(this.videoConfig.source[t])return this.videoConfig.source[t];return""}generateLogoHTML(){const e=this.videoConfig.playerLogo;if(!e||!e.src)return"";const t=`\n            width: ${e.width||"auto"};\n            height: ${e.height||"auto"};\n            opacity: ${e.opacity||"1"};\n        `,n=e.position||"bottom end",i=this.getLogoPositionClass(n),o=`<img src="${e.src}" alt="Player Logo" style="${t}">`;if(e.href){const t=e.target?`target="${e.target}"`:"";return`<div class="player-logo-dynamic ${i}"><a href="${e.href}" ${t} class="logo-link">${o}</a></div>`}return`<div class="player-logo-dynamic ${i}">${o}</div>`}getLogoPositionClass(e){switch(e.toLowerCase()){case"top start":return"logo-top-start";case"top end":return"logo-top-end";case"bottom start":return"logo-bottom-start";default:return"logo-bottom-end"}}generateThemeColors(){const e=this.theme.color,t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return{base:e,lighter:`rgb(${Math.min(255,t+40)}, ${Math.min(255,n+40)}, ${Math.min(255,i+40)})`,darker:`rgb(${Math.max(0,t-40)}, ${Math.max(0,n-40)}, ${Math.max(0,i-40)})`,rgb:`rgb(${t}, ${n}, ${i})`,rgba:e=>`rgba(${t}, ${n}, ${i}, ${e})`}}applyStyles(){const e=this.generateThemeColors(),t=`\n                    .video-player-container {\n                        background: #1a1a1a;\n                        border-radius: 16px;\n                        overflow: hidden;\n                        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);\n                        position: relative;\n                    }\n\n                    .main-video {\n                        width: 100%;\n                        height: auto;\n                        display: block;\n                        background: #000;\n                        object-fit: cover;\n                    }\n\n                    .main-video[poster] {\n                        background-size: cover;\n                        background-position: center;\n                        background-repeat: no-repeat;\n                    }\n\n                    .thumbnail-overlay {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        right: 0;\n                        bottom: 0;\n                        background: rgba(0, 0, 0, 0.3);\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        z-index: 15;\n                        cursor: pointer;\n                        transition: all 0.3s ease;\n                    }\n\n                    .thumbnail-overlay:hover {\n                        background: rgba(0, 0, 0, 0.5);\n                    }\n\n                    .thumbnail-play-btn {\n                        width: 80px;\n                        height: 80px;\n                        border-radius: 50%;\n                        background: linear-gradient(135deg, ${e.base}, ${e.lighter});\n                        border: none;\n                        color: white;\n                        font-size: 28px;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        cursor: pointer;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);\n                        position: relative;\n                        z-index: 20;\n                        pointer-events: auto;\n                        outline: none;\n                    }\n\n                    .thumbnail-play-btn:hover {\n                        transform: scale(1.1);\n                        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);\n                        background: linear-gradient(135deg, ${e.lighter}, ${e.base});\n                    }\n\n                    .thumbnail-play-btn:active {\n                        transform: scale(0.95);\n                    }\n\n                    .thumbnail-play-btn i {\n                        margin-left: 4px;\n                    }\n\n                    /* Glowing Play/Pause Overlay Effect */\n                    .video-click-overlay {\n                        position: absolute;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        width: 100px;\n                        height: 100px;\n                        border-radius: 50%;\n                        background: linear-gradient(135deg, ${e.base}, ${e.lighter});\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        z-index: 25;\n                        opacity: 0;\n                        pointer-events: none;\n                        box-shadow: 0 0 30px ${e.rgba(.6)}, 0 0 60px ${e.rgba(.4)};\n                        transition: none;\n                    }\n\n                    .video-click-overlay i {\n                        font-size: 36px;\n                        color: white;\n                        margin-left: 3px;\n                        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n                    }\n\n                    .video-click-overlay.show {\n                        animation: glowFadeEffect 0.8s ease-out forwards;\n                    }\n\n                    @keyframes glowFadeEffect {\n                        0% {\n                            opacity: 0;\n                            transform: translate(-50%, -50%) scale(0.5);\n                            box-shadow: 0 0 0 ${e.rgba(0)}, 0 0 0 ${e.rgba(0)};\n                        }\n                        30% {\n                            opacity: 0.9;\n                            transform: translate(-50%, -50%) scale(1.1);\n                            box-shadow: 0 0 40px ${e.rgba(.8)}, 0 0 80px ${e.rgba(.6)};\n                        }\n                        70% {\n                            opacity: 0.7;\n                            transform: translate(-50%, -50%) scale(1);\n                            box-shadow: 0 0 35px ${e.rgba(.6)}, 0 0 70px ${e.rgba(.4)};\n                        }\n                        100% {\n                            opacity: 0;\n                            transform: translate(-50%, -50%) scale(0.9);\n                            box-shadow: 0 0 20px ${e.rgba(.3)}, 0 0 40px ${e.rgba(.2)};\n                        }\n                    }\n\n                    .video-controls {\n                        padding: 15px 20px;\n                        background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);\n                        position: absolute;\n                        bottom: 0;\n                        left: 0;\n                        right: 0;\n                        z-index: 10;\n                        opacity: 0;\n                        transition: opacity 0.3s ease;\n                    }\n\n                    .video-player-container:hover .video-controls {\n                        opacity: 1;\n                    }\n\n                    .progress-container {\n                        position: relative;\n                        margin-bottom: 15px;\n                        cursor: pointer;\n                    }\n\n                    .progress-bar {\n                        width: 100%;\n                        height: 6px;\n                        background: rgba(255, 255, 255, 0.2);\n                        border-radius: 3px;\n                        overflow: hidden;\n                        position: relative;\n                    }\n\n                    .progress {\n                        height: 100%;\n                        background: linear-gradient(90deg, ${e.base}, ${e.lighter});\n                        border-radius: 3px;\n                        width: 0%;\n                        transition: width 0.1s ease;\n                    }\n\n                    .progress-handle {\n                        width: 14px;\n                        height: 14px;\n                        background: white;\n                        border-radius: 50%;\n                        position: absolute;\n                        top: 50%;\n                        transform: translate(-50%, -50%);\n                        opacity: 0;\n                        transition: opacity 0.2s ease;\n                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);\n                    }\n\n                    .progress-container:hover .progress-handle {\n                        opacity: 1;\n                    }\n\n                    .preview-container {\n                        position: absolute;\n                        bottom: 25px;\n                        background: #000;\n                        border-radius: 8px;\n                        overflow: hidden;\n                        opacity: 0;\n                        pointer-events: none;\n                        transform: translateX(-50%);\n                        transition: opacity 0.2s ease;\n                        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n                        z-index: 20;\n                        width: 160px;\n                        height: 90px;\n                    }\n\n                    .preview-thumbnail {\n                        width: 100%;\n                        height: 100%;\n                        background: #333;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        color: white;\n                        font-size: 12px;\n                        background-size: cover;\n                        background-position: center;\n                    }\n\n                    .preview-time {\n                        position: absolute;\n                        bottom: 0;\n                        left: 0;\n                        right: 0;\n                        padding: 6px;\n                        background: rgba(0, 0, 0, 0.8);\n                        color: white;\n                        font-size: 12px;\n                        text-align: center;\n                    }\n\n                    .control-buttons {\n                        display: flex;\n                        align-items: center;\n                        gap: 15px;\n                    }\n\n                    .control-group {\n                        display: flex;\n                        align-items: center;\n                        gap: 12px;\n                        position: relative;\n                    }\n                    \n                    /* Mobile-specific control group spacing */\n                    .mobile-view .control-group {\n                        gap: 8px;\n                    }\n\n                    .control-group:last-child {\n                        gap: 8px;\n                    }\n\n                    .control-btn {\n                        background: none;\n                        border: none;\n                        color: white;\n                        font-size: 18px;\n                        cursor: pointer;\n                        padding: 8px;\n                        border-radius: 50%;\n                        transition: all 0.2s ease;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                    }\n\n                    .control-btn:hover {\n                        background: rgba(255, 255, 255, 0.1);\n                        transform: scale(1.1);\n                    }\n\n                    .control-btn:active {\n                        transform: scale(0.95);\n                    }\n\n                    .pip-btn {\n                        position: relative;\n                    }\n\n                    .pip-btn.active {\n                        background: ${e.rgba(.2)};\n                        color: ${e.base};\n                    }\n\n                    .theater-btn {\n                        position: relative;\n                    }\n\n                    .theater-btn.active {\n                        background: ${e.rgba(.2)};\n                        color: ${e.base};\n                    }\n\n                    .loop-btn {\n                        position: relative;\n                    }\n\n                    .loop-btn.active {\n                        background: ${e.rgba(.2)};\n                        color: ${e.base};\n                    }\n\n                    .loop-btn.active i {\n                        animation: spin 2s linear infinite;\n                    }\n\n                    @keyframes spin {\n                        from { transform: rotate(0deg); }\n                        to { transform: rotate(360deg); }\n                    }\n\n                    /* Loading Spinner Styles */\n                    .loading-spinner-overlay {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        width: 100%;\n                        height: 100%;\n                        background: rgba(0, 0, 0, 0.8);\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        z-index: 1000;\n                        backdrop-filter: blur(2px);\n                        transition: opacity 0.3s ease;\n                    }\n                    \n                    .loading-spinner {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        gap: 20px;\n                    }\n                    \n                    .spinner-ring {\n                        width: 60px;\n                        height: 60px;\n                        border: 4px solid rgba(255, 255, 255, 0.2);\n                        border-left: 4px solid ${e.base};\n                        border-radius: 50%;\n                        animation: spin 1s linear infinite;\n                        box-shadow: 0 0 20px ${e.rgba(.3)}, inset 0 0 20px ${e.rgba(.1)};\n                    }\n                    \n                    .spinner-text {\n                        color: white;\n                        font-size: 16px;\n                        font-weight: 500;\n                        text-shadow: 0 0 10px ${e.rgba(.5)};\n                        animation: pulse 2s ease-in-out infinite;\n                    }\n                    \n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                    \n                    @keyframes pulse {\n                        0%, 100% { opacity: 0.7; }\n                        50% { opacity: 1; }\n                    }\n\n                    /* Theater Mode Styles */\n                    .video-player-container.theater-mode {\n                        position: fixed;\n                        top: 0;\n                        left: 0;\n                        right: 0;\n                        bottom: 0;\n                        z-index: 9999;\n                        border-radius: 0;\n                        width: 100vw;\n                        height: 100vh;\n                        max-width: none;\n                        max-height: none;\n                        transition: all 0.3s ease;\n                        box-shadow: none;\n                        background: #000;\n                    }\n\n                    .video-player-container.theater-mode .main-video {\n                        width: 100%;\n                        height: 100%;\n                        object-fit: contain;\n                        background: #000;\n                    }\n\n                    .video-player-container.theater-mode .video-controls {\n                        background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);\n                        padding: 20px 30px;\n                    }\n\n                    .video-player-container.theater-mode .player-title {\n                        top: 20px;\n                        left: 30px;\n                        font-size: 18px;\n                    }\n\n                    /* Theater mode backdrop - removed as we're using full window */\n                    .theater-backdrop {\n                        display: none;\n                    }\n\n                    .play-pause {\n                        background: linear-gradient(135deg, ${e.base}, ${e.lighter});\n                        width: 45px;\n                        height: 45px;\n                        font-size: 16px;\n                    }\n\n                    .play-pause:hover {\n                        background: linear-gradient(135deg, ${e.darker}, ${e.base});\n                        transform: scale(1.05);\n                    }\n\n                    .volume-container {\n                        display: flex;\n                        align-items: center;\n                        gap: 8px;\n                        will-change: transform;\n                        backface-visibility: hidden;\n                        transform: translateZ(0);\n                        position: relative;\n                    }\n\n                    .volume-btn {\n                        will-change: transform;\n                        backface-visibility: hidden;\n                        transform: translateZ(0);\n                        transition: all 0.2s ease;\n                        user-select: none;\n                    }\n\n                    .volume-btn i {\n                        will-change: transform;\n                        backface-visibility: hidden;\n                        transform: translateZ(0);\n                    }\n\n                    .volume-slider {\n                        width: 80px;\n                        height: 4px;\n                        background: rgba(255, 255, 255, 0.2);\n                        border-radius: 2px;\n                        position: relative;\n                        cursor: pointer;\n                        will-change: transform;\n                        backface-visibility: hidden;\n                        transform: translateZ(0);\n                    }\n\n                    .volume-level {\n                        height: 100%;\n                        background: ${e.base};\n                        border-radius: 2px;\n                        width: 100%;\n                        transition: width 0.1s ease-out;\n                        will-change: width;\n                        backface-visibility: hidden;\n                        transform: translateZ(0);\n                    }\n\n                    .time-display {\n                        color: white;\n                        font-size: 14px;\n                        font-variant-numeric: tabular-nums;\n                    }\n\n                    .control-spacer {\n                        flex: 1;\n                    }\n\n                    .speed-selector {\n                        background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));\n                        border: 1px solid rgba(255, 255, 255, 0.3);\n                        color: white;\n                        padding: 10px 14px;\n                        border-radius: 12px;\n                        cursor: pointer;\n                        font-size: 13px;\n                        font-weight: 500;\n                        min-width: 70px;\n                        text-align: center;\n                        margin-right: 12px;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n                        backdrop-filter: blur(12px);\n                        -webkit-backdrop-filter: blur(12px);\n                        appearance: none;\n                        position: relative;\n                    }\n\n                    .speed-selector:hover {\n                        background: linear-gradient(135deg, ${e.rgba(.25)}, ${e.rgba(.1)});\n                        border-color: ${e.rgba(.6)};\n                        transform: translateY(-2px);\n                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 0 1px ${e.rgba(.3)}, inset 0 1px 0 rgba(255, 255, 255, 0.2);\n                    }\n\n                    .speed-selector:focus {\n                        outline: none;\n                        border-color: ${e.base};\n                        box-shadow: 0 0 0 3px ${e.rgba(.3)}, 0 8px 25px rgba(0, 0, 0, 0.3);\n                        transform: translateY(-1px);\n                    }\n\n                    .speed-selector:active {\n                        transform: translateY(0);\n                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n                    }\n\n                    .speed-selector option {\n                        background-color: #2a2a2a !important;\n                        background: #2a2a2a !important;\n                        color: white !important;\n                        padding: 12px 16px;\n                        border: none;\n                        font-size: 13px;\n                        font-weight: 500;\n                        text-shadow: none;\n                    }\n\n                    .speed-selector option:hover {\n                        background-color: ${e.base} !important;\n                        background: ${e.base} !important;\n                        color: white !important;\n                    }\n\n                    .speed-selector option:checked,\n                    .speed-selector option:selected {\n                        background-color: ${e.base} !important;\n                        background: ${e.base} !important;\n                        color: white !important;\n                        font-weight: 600;\n                    }\n\n                    .quality-selector {\n                        background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));\n                        border: 1px solid rgba(255, 255, 255, 0.3);\n                        color: white;\n                        padding: 10px 14px;\n                        border-radius: 12px;\n                        cursor: pointer;\n                        font-size: 13px;\n                        font-weight: 500;\n                        min-width: 100px;\n                        text-align: left;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n                        backdrop-filter: blur(12px);\n                        -webkit-backdrop-filter: blur(12px);\n                        appearance: none;\n                        position: relative;\n                    }\n\n                    .quality-selector:hover {\n                        background: linear-gradient(135deg, ${e.rgba(.25)}, ${e.rgba(.1)});\n                        border-color: ${e.rgba(.6)};\n                        transform: translateY(-2px);\n                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 0 1px ${e.rgba(.3)}, inset 0 1px 0 rgba(255, 255, 255, 0.2);\n                    }\n\n                    .quality-selector:focus {\n                        outline: none;\n                        border-color: ${e.base};\n                        box-shadow: 0 0 0 3px ${e.rgba(.3)}, 0 8px 25px rgba(0, 0, 0, 0.3);\n                        transform: translateY(-1px);\n                    }\n\n                    .quality-selector:active {\n                        transform: translateY(0);\n                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n                    }\n\n                    .quality-selector option {\n                        background-color: #2a2a2a !important;\n                        background: #2a2a2a !important;\n                        color: white !important;\n                        padding: 12px 16px;\n                        border: none;\n                        font-size: 13px;\n                        font-weight: 500;\n                        text-shadow: none;\n                    }\n\n                    .quality-selector option:hover {\n                        background-color: ${e.base} !important;\n                        background: ${e.base} !important;\n                        color: white !important;\n                    }\n\n                    .quality-selector option:checked,\n                    .quality-selector option:selected {\n                        background-color: ${e.base} !important;\n                        background: ${e.base} !important;\n                        color: white !important;\n                        font-weight: 600;\n                    }\n\n                    /* Cross-browser dropdown styling fixes */\n                    .speed-selector::-ms-expand,\n                    .quality-selector::-ms-expand {\n                        display: none;\n                    }\n\n\n\n                    /* Force dropdown list styling */\n                    .speed-selector,\n                    .quality-selector {\n                        -webkit-appearance: none;\n                        -moz-appearance: none;\n                        appearance: none;\n                    }\n\n                    /* Additional option styling for better browser compatibility */\n                    select.speed-selector option,\n                    select.quality-selector option {\n                        background-color: #2a2a2a !important;\n                        color: white !important;\n                        border: none !important;\n                        outline: none !important;\n                    }\n\n                    select.speed-selector option:hover,\n                    select.quality-selector option:hover {\n                        background-color: ${e.base} !important;\n                        color: white !important;\n                    }\n\n                    select.speed-selector option:focus,\n                    select.quality-selector option:focus,\n                    select.subtitle-selector option:focus {\n                        background-color: ${e.base} !important;\n                        color: white !important;\n                    }\n\n                    .subtitle-selector {\n                        background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));\n                        border: 1px solid rgba(255, 255, 255, 0.3);\n                        color: white;\n                        padding: 10px 14px;\n                        border-radius: 12px;\n                        cursor: pointer;\n                        font-size: 13px;\n                        font-weight: 500;\n                        min-width: 90px;\n                        text-align: left;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n                        backdrop-filter: blur(12px);\n                        -webkit-backdrop-filter: blur(12px);\n                        appearance: none;\n                        position: relative;\n                    }\n\n                    .subtitle-selector:hover {\n                        background: linear-gradient(135deg, ${e.rgba(.25)}, ${e.rgba(.1)});\n                        border-color: ${e.rgba(.6)};\n                        transform: translateY(-2px);\n                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 0 1px ${e.rgba(.3)}, inset 0 1px 0 rgba(255, 255, 255, 0.2);\n                    }\n\n                    .subtitle-selector:focus {\n                        outline: none;\n                        border-color: ${e.base};\n                        box-shadow: 0 0 0 3px ${e.rgba(.3)}, 0 8px 25px rgba(0, 0, 0, 0.3);\n                        transform: translateY(-1px);\n                    }\n\n                    .subtitle-selector:active {\n                        transform: translateY(0);\n                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n                    }\n\n                    .subtitle-selector option {\n                        background-color: #2a2a2a !important;\n                        background: #2a2a2a !important;\n                        color: white !important;\n                        padding: 12px 16px;\n                        border: none;\n                        font-size: 13px;\n                        font-weight: 500;\n                        text-shadow: none;\n                    }\n\n                    .subtitle-selector option:hover {\n                        background-color: ${e.base} !important;\n                        background: ${e.base} !important;\n                        color: white !important;\n                    }\n\n                    .subtitle-selector option:checked,\n                    .subtitle-selector option:selected {\n                        background-color: ${e.base} !important;\n                        background: ${e.base} !important;\n                        color: white !important;\n                        font-weight: 600;\n                    }\n\n                    /* Cross-browser subtitle selector styling */\n                    .subtitle-selector::-ms-expand {\n                        display: none;\n                    }\n\n                    select.subtitle-selector option {\n                        background-color: #2a2a2a !important;\n                        color: white !important;\n                        border: none !important;\n                        outline: none !important;\n                    }\n\n                    select.subtitle-selector option:hover {\n                        background-color: ${e.base} !important;\n                        color: white !important;\n                    }\n\n                    /* Selector container styling */\n                    .selector-container {\n                        position: relative;\n                        display: inline-block;\n                    }\n\n                    /* Modern tooltip styling */\n                    .selector-container::before {\n                        content: attr(data-tooltip);\n                        position: absolute;\n                        bottom: calc(100% + 12px);\n                        left: 50%;\n                        transform: translateX(-50%);\n                        background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));\n                        color: white;\n                        padding: 6px 12px;\n                        border-radius: 8px;\n                        font-size: 11px;\n                        font-weight: 500;\n                        white-space: nowrap;\n                        opacity: 0;\n                        visibility: hidden;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        pointer-events: none;\n                        z-index: 1000;\n                        backdrop-filter: blur(8px);\n                        -webkit-backdrop-filter: blur(8px);\n                        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);\n                    }\n\n                    .selector-container::after {\n                        content: '';\n                        position: absolute;\n                        bottom: calc(100% + 6px);\n                        left: 50%;\n                        transform: translateX(-50%);\n                        width: 0;\n                        height: 0;\n                        border-left: 5px solid transparent;\n                        border-right: 5px solid transparent;\n                        border-top: 6px solid rgba(0, 0, 0, 0.9);\n                        opacity: 0;\n                        visibility: hidden;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        pointer-events: none;\n                        z-index: 1000;\n                    }\n\n                    .selector-container:hover::before,\n                    .selector-container:hover::after {\n                        opacity: 1;\n                        visibility: visible;\n                        transform: translateX(-50%) translateY(-2px);\n                    }\n\n                    /* Selector container styling */\n                    .selector-container {\n                        position: relative;\n                        display: inline-block;\n                    }\n\n                    /* Modern tooltip styling */\n                    .selector-container::before {\n                        content: attr(data-tooltip);\n                        position: absolute;\n                        bottom: calc(100% + 12px);\n                        left: 50%;\n                        transform: translateX(-50%);\n                        background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));\n                        color: white;\n                        padding: 6px 12px;\n                        border-radius: 8px;\n                        font-size: 11px;\n                        font-weight: 500;\n                        white-space: nowrap;\n                        opacity: 0;\n                        visibility: hidden;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        pointer-events: none;\n                        z-index: 1000;\n                        backdrop-filter: blur(8px);\n                        -webkit-backdrop-filter: blur(8px);\n                        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);\n                    }\n\n                    .selector-container::after {\n                        content: '';\n                        position: absolute;\n                        bottom: calc(100% + 6px);\n                        left: 50%;\n                        transform: translateX(-50%);\n                        width: 0;\n                        height: 0;\n                        border-left: 5px solid transparent;\n                        border-right: 5px solid transparent;\n                        border-top: 6px solid rgba(0, 0, 0, 0.9);\n                        opacity: 0;\n                        visibility: hidden;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        pointer-events: none;\n                        z-index: 1000;\n                    }\n\n                    .selector-container:hover::before,\n                    .selector-container:hover::after {\n                        opacity: 1;\n                        visibility: visible;\n                        transform: translateX(-50%) translateY(-2px);\n                    }\n\n                    /* Desktop Controls - Default state */\n                    .mobile-menu-toggle {\n                        display: none;\n                    }\n                    \n                    .mobile-controls-menu {\n                        display: none;\n                    }\n                    \n                    .desktop-controls {\n                        display: flex;\n                    }\n                    \n                    /* Mobile View - When video container width < 780px */\n                    .mobile-view .mobile-menu-toggle {\n                        display: flex !important;\n                        align-items: center;\n                        gap: 12px;\n                    }\n                    \n                    .mobile-view .mobile-controls-menu {\n                        display: block !important;\n                    }\n                    \n                    .mobile-view .desktop-controls {\n                        display: none !important;\n                    }\n                    \n                    .mobile-view .desktop-time {\n                        display: none !important;\n                    }\n                    \n                    /* Force desktop controls in theater and fullscreen modes */\n                    .theater-mode .desktop-controls,\n                    :fullscreen .desktop-controls {\n                        display: flex !important;\n                    }\n                    \n                    .theater-mode .mobile-menu-toggle,\n                    :fullscreen .mobile-menu-toggle {\n                        display: none !important;\n                    }\n                    \n                    .theater-mode .mobile-controls-menu,\n                    :fullscreen .mobile-controls-menu {\n                        display: none !important;\n                    }\n                    \n                    /* Force desktop controls in theater and fullscreen modes */\n                    .theater-mode .desktop-controls,\n                    :fullscreen .desktop-controls {\n                        display: flex !important;\n                    }\n                    \n                    .theater-mode .mobile-menu-toggle,\n                    :fullscreen .mobile-menu-toggle {\n                        display: none !important;\n                    }\n                    \n                    .theater-mode .mobile-controls-menu,\n                    :fullscreen .mobile-controls-menu {\n                        display: none !important;\n                    }\n\n                    /* Enhanced mobile responsiveness for screens 780px and smaller */\n                    @media (max-width: 780px) {\n                        .mobile-controls-menu {\n                            width: 260px;\n                            max-width: calc(100vw - 20px);\n                            padding: 14px;\n                            right: 10px;\n                            bottom: 70px;\n                        }\n                        \n                        .mobile-control-row {\n                            margin-bottom: 10px;\n                            padding: 3px 0;\n                        }\n                        \n                        .mobile-control-row label {\n                            font-size: 12px;\n                        }\n                        \n                        .mobile-control-row select {\n                            padding: 8px 10px;\n                            font-size: 12px;\n                            min-height: 35px;\n                        }\n                        \n                        .mobile-control-btn {\n                            padding: 8px 12px;\n                            font-size: 13px;\n                            min-height: 38px;\n                            gap: 8px;\n                        }\n                        \n                        .mobile-buttons {\n                            gap: 6px;\n                        }\n                    }\n\n                    @media (max-width: 768px) {\n                        .speed-selector {\n                            min-width: 60px;\n                            padding: 8px 12px 8px 10px;\n                            font-size: 12px;\n                            margin-right: 8px;\n                        }\n                        \n                        .quality-selector {\n                            min-width: 85px;\n                            padding: 8px 12px 8px 10px;\n                            font-size: 12px;\n                        }\n                        \n                        .subtitle-selector {\n                            min-width: 75px;\n                            padding: 8px 12px 8px 10px;\n                            font-size: 12px;\n                        }\n\n                        .selector-container::before {\n                            display: none; /* Hide tooltips on mobile */\n                        }\n\n                        .selector-container::after {\n                            display: none;\n                        }\n                    }\n\n                        display: none;\n                        }\n                    }\n\n                    /* Preview hover animations - expanded hover area */\n                    .progress-container::before {\n                        content: '';\n                        position: absolute;\n                        top: -15px;\n                        left: 0;\n                        right: 0;\n                        bottom: -15px;\n                        z-index: 1;\n                    }\n\n                    .progress-container:hover .preview-container {\n                        opacity: 1;\n                    }\n\n                    @keyframes fadeInScale {\n                        from {\n                            opacity: 0;\n                            transform: scale(0.9);\n                        }\n                        to {\n                            opacity: 1;\n                            transform: scale(1);\n                        }\n                    }\n\n                    /* Hide preview container when thumbnails are disabled */\n                    .thumbnails-disabled .preview-container {\n                        display: none !important;\n                    }\n\n                    .player-title {\n                        position: absolute;\n                        top: 15px;\n                        left: 15px;\n                        color: white;\n                        font-size: 16px;\n                        font-weight: 600;\n                        background: rgba(0, 0, 0, 0.5);\n                        padding: 5px 10px;\n                        border-radius: 4px;\n                        z-index: 5;\n                    }\n\n                    /* Dynamic Player Logo Styles */\n                    .player-logo-dynamic {\n                        position: absolute;\n                        z-index: 8;\n                        opacity: 0.7;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        pointer-events: auto;\n                        transform: translateY(0);\n                    }\n\n                    /* Logo Position Classes */\n                    .player-logo-dynamic.logo-top-start {\n                        top: 20px;\n                        left: 20px;\n                    }\n\n                    .player-logo-dynamic.logo-top-end {\n                        top: 20px;\n                        right: 20px;\n                    }\n\n                    .player-logo-dynamic.logo-bottom-start {\n                        bottom: 20px;\n                        left: 20px;\n                    }\n\n                    .player-logo-dynamic.logo-bottom-end {\n                        bottom: 20px;\n                        right: 20px;\n                    }\n\n                    .player-logo-dynamic img {\n                        display: block;\n                        max-width: 120px;\n                        max-height: 60px;\n                        object-fit: contain;\n                        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));\n                        border-radius: 4px;\n                        transition: all 0.2s ease;\n                    }\n\n                    /* Logo link styling */\n                    .player-logo-dynamic .logo-link {\n                        display: inline-block;\n                        text-decoration: none;\n                        transition: all 0.2s ease;\n                    }\n\n                    .player-logo-dynamic .logo-link:hover {\n                        transform: scale(1.05);\n                        filter: brightness(1.1);\n                    }\n\n                    .player-logo-dynamic .logo-link:active {\n                        transform: scale(0.98);\n                    }\n\n                    /* Logo hover effects for non-clickable logos */\n                    .player-logo-dynamic:not(:has(.logo-link)):hover {\n                        transform: translateY(0) scale(1.05);\n                        filter: brightness(1.1);\n                    }\n\n                    /* Logo moves when controls are visible - position specific */\n                    .video-player-container:hover .player-logo-dynamic.logo-bottom-start,\n                    .video-player-container:hover .player-logo-dynamic.logo-bottom-end {\n                        transform: translateY(-80px);\n                        opacity: 0.9;\n                    }\n\n                    .video-player-container:hover .player-logo-dynamic.logo-top-start,\n                    .video-player-container:hover .player-logo-dynamic.logo-top-end {\n                        transform: translateY(80px);\n                        opacity: 0.9;\n                    }\n\n                    .video-player-container:hover .player-logo-dynamic.logo-bottom-start:hover,\n                    .video-player-container:hover .player-logo-dynamic.logo-bottom-end:hover {\n                        transform: translateY(-80px) scale(1.05);\n                        opacity: 1;\n                    }\n\n                    .video-player-container:hover .player-logo-dynamic.logo-top-start:hover,\n                    .video-player-container:hover .player-logo-dynamic.logo-top-end:hover {\n                        transform: translateY(80px) scale(1.05);\n                        opacity: 1;\n                    }\n\n                    /* Logo fades out when controls are fully visible */\n                    .video-player-container.controls-active .player-logo-dynamic {\n                        opacity: 0.6;\n                    }\n\n                    /* Custom cursor for progress bar */\n                    .progress-container {\n                        cursor: pointer;\n                    }\n\n                    /* Mobile Controls Menu */\n                    .mobile-controls-menu {\n                        position: fixed;\n                        bottom: 80px;\n                        right: 15px;\n                        transform: translateY(20px) scale(0.95);\n                        background: rgba(0, 0, 0, 0.92);\n                        border-radius: 12px;\n                        padding: 16px;\n                        width: 280px;\n                        max-width: calc(100vw - 30px);\n                        max-height: 60vh;\n                        overflow-y: auto;\n                        opacity: 0;\n                        visibility: hidden;\n                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                        z-index: 1000;\n                        backdrop-filter: blur(15px);\n                        border: 1px solid rgba(255, 255, 255, 0.2);\n                        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);\n                    }\n\n                    .mobile-controls-menu.show {\n                        opacity: 1;\n                        visibility: visible;\n                        transform: translateY(0) scale(1);\n                    }\n\n                    /* Mobile menu backdrop */\n                    .mobile-menu-backdrop {\n                        position: fixed;\n                        top: 0;\n                        left: 0;\n                        width: 100%;\n                        height: 100%;\n                        background: transparent;\n                        z-index: 999;\n                        opacity: 0;\n                        visibility: hidden;\n                        transition: all 0.3s ease;\n                    }\n\n                    .mobile-menu-backdrop.show {\n                        opacity: 1;\n                        visibility: visible;\n                    }\n\n                    .mobile-control-row {\n                        display: flex;\n                        align-items: center;\n                        justify-content: space-between;\n                        margin-bottom: 12px;\n                        gap: 10px;\n                        padding: 4px 0;\n                    }\n\n                    .mobile-control-row:last-child {\n                        margin-bottom: 0;\n                    }\n\n                    .mobile-control-row label {\n                        color: white;\n                        font-size: 13px;\n                        font-weight: 500;\n                        flex: 1;\n                        white-space: nowrap;\n                    }\n\n                    .mobile-control-row select {\n                        background: rgba(40, 40, 40, 0.95);\n                        border: 1px solid rgba(255, 255, 255, 0.3);\n                        border-radius: 8px;\n                        color: white;\n                        padding: 10px 12px;\n                        font-size: 14px;\n                        flex: 2;\n                        appearance: none;\n                        min-height: 40px;\n                        cursor: pointer;\n                    }\n\n                    .mobile-control-row select option {\n                        background: #2a2a2a;\n                        color: white;\n                        padding: 8px 12px;\n                        border: none;\n                    }\n\n                    .mobile-control-row select:focus {\n                        outline: none;\n                        border-color: var(--primary-color, #16a085);\n                        box-shadow: 0 0 0 2px rgba(22, 160, 133, 0.2);\n                        background: rgba(50, 50, 50, 0.95);\n                    }\n\n                    .mobile-buttons {\n                        display: flex;\n                        flex-direction: column;\n                        gap: 8px;\n                        margin-top: 6px;\n                    }\n\n                    .mobile-control-btn {\n                        background: rgba(255, 255, 255, 0.12);\n                        border: 1px solid rgba(255, 255, 255, 0.25);\n                        border-radius: 8px;\n                        color: white;\n                        padding: 10px 12px;\n                        display: flex;\n                        align-items: center;\n                        gap: 10px;\n                        width: 100%;\n                        cursor: pointer;\n                        transition: all 0.2s ease;\n                        font-size: 14px;\n                        font-weight: 500;\n                        min-height: 40px;\n                        justify-content: flex-start;\n                    }\n\n                    .mobile-control-btn:hover,\n                    .mobile-control-btn:focus {\n                        background: rgba(255, 255, 255, 0.25);\n                        border-color: rgba(255, 255, 255, 0.4);\n                        transform: translateY(-1px);\n                    }\n\n                    .mobile-control-btn.active {\n                        background: rgba(22, 160, 133, 0.2);\n                        border-color: #16a085;\n                        color: #16a085;\n                    }\n\n                    /* Responsive Design */\n                    .mobile-view .video-player-container {\n                        border-radius: 12px;\n                    }\n                    \n                    .mobile-view .video-controls {\n                        padding: 10px 15px;\n                    }\n                    \n                    /* Mobile control layout: align essential controls on left, menu toggle on right */\n                    .mobile-view .control-buttons {\n                        display: flex;\n                        justify-content: space-between;\n                        align-items: center;\n                        width: 100%;\n                        flex-wrap: nowrap;\n                        gap: 8px;\n                    }\n                    \n                    /* Essential controls wrapper for mobile */\n                    .essential-controls-wrapper {\n                        display: flex;\n                        align-items: center;\n                        gap: 6px;\n                        flex: 0 0 auto;\n                    }\n                    \n                    /* Mobile view: align essential controls wrapper to start */\n                    .mobile-view .essential-controls-wrapper {\n                        justify-content: flex-start;\n                    }\n                    \n                    /* Essential controls (play, volume) aligned to start/left */\n                    .mobile-view .essential-controls {\n                        display: flex;\n                        align-items: center;\n                        gap: 6px;\n                        flex: 0 0 auto;\n                    }\n                    \n                    .mobile-view .control-spacer {\n                        display: none;\n                    }\n                    \n                    /* Mobile time display styling */\n                    .mobile-time {\n                        color: white;\n                        font-size: 13px;\n                        font-variant-numeric: tabular-nums;\n                        white-space: nowrap;\n                        margin-right: 8px;\n                    }\n                    \n                    /* Default state - hide mobile time */\n                    .mobile-time {\n                        display: none;\n                    }\n                    \n                    /* Show mobile time only in mobile view */\n                    .mobile-view .mobile-time {\n                        display: inline-block;\n                    }\n                    \n                    /* Mobile volume controls styling */\n                    .mobile-view .volume-container {\n                        margin-left: 4px;\n                    }\n                    \n                    .mobile-view .volume-slider {\n                        width: 50px;\n                    }\n                    \n                    /* Essential controls on left, mobile menu toggle on right */\n                    .mobile-view .control-buttons {\n                        justify-content: space-between;\n                        gap: 10px;\n                    }\n                    \n                    /* Ensure all controls stay in horizontal line */\n                    .mobile-view .control-buttons > * {\n                        flex: 0 0 auto;\n                    }\n                        \n                        .preview-container {\n                            width: 120px;\n                            height: 68px;\n                        }\n                        \n                        .volume-slider {\n                            width: 45px;\n                            height: 4px;\n                        }\n                        \n                        .volume-container {\n                            gap: 4px;\n                        }\n                        \n                        /* Tighter spacing in mobile for horizontal alignment */\n                        .mobile-view .essential-controls-wrapper {\n                            gap: 6px !important;\n                        }\n                        \n                        .mobile-view .essential-controls {\n                            gap: 4px !important;\n                        }\n                        \n                        /* Maintain space-between layout in mobile */\n                        .mobile-view .control-buttons {\n                            justify-content: space-between !important;\n                            gap: 8px !important;\n                        }\n                        \n                        /* Smaller volume slider for mobile */\n                        .mobile-view .volume-slider {\n                            width: 40px !important;\n                        }\n                        \n                        .volume-level {\n                            transition: width 0.06s ease-out;\n                        }\n                        \n                        /* Mobile responsive logo positions */\n                        .player-logo-dynamic.logo-top-start {\n                            top: 15px;\n                            left: 15px;\n                        }\n                        \n                        .player-logo-dynamic.logo-top-end {\n                            top: 15px;\n                            right: 15px;\n                        }\n                        \n                        .player-logo-dynamic.logo-bottom-start {\n                            bottom: 15px;\n                            left: 15px;\n                        }\n                        \n                        .player-logo-dynamic.logo-bottom-end {\n                            bottom: 15px;\n                            right: 15px;\n                        }\n                        \n                        .player-logo-dynamic img {\n                            max-height: 35px !important;\n                            max-width: 80px !important;\n                        }\n                        \n                        /* Mobile hover animations */\n                        .video-player-container:hover .player-logo-dynamic.logo-bottom-start,\n                        .video-player-container:hover .player-logo-dynamic.logo-bottom-end {\n                            transform: translateY(-70px);\n                        }\n                        \n                        .video-player-container:hover .player-logo-dynamic.logo-top-start,\n                        .video-player-container:hover .player-logo-dynamic.logo-top-end {\n                            transform: translateY(70px);\n                        }\n                        \n                        .video-player-container:hover .player-logo-dynamic.logo-bottom-start:hover,\n                        .video-player-container:hover .player-logo-dynamic.logo-bottom-end:hover {\n                            transform: translateY(-70px) scale(1.05);\n                        }\n                        \n                        .video-player-container:hover .player-logo-dynamic.logo-top-start:hover,\n                        .video-player-container:hover .player-logo-dynamic.logo-top-end:hover {\n                            transform: translateY(70px) scale(1.05);\n                        }\n                        \n                        /* Mobile thumbnail play button */\n                        .thumbnail-play-btn {\n                            width: 60px !important;\n                            height: 60px !important;\n                            font-size: 22px !important;\n                        }\n                        \n                        /* Mobile video click overlay */\n                        .video-click-overlay {\n                            width: 80px !important;\n                            height: 80px !important;\n                        }\n                        \n                        .video-click-overlay i {\n                            font-size: 28px !important;\n                        }\n                    }\n\n                    /* Hide native controls */\n                    .main-video::-webkit-media-controls {\n                        display: none !important;\n                    }\n                `,n=document.createElement("style");n.textContent=t,document.head.appendChild(n)}setupEventListeners(){this.playPauseBtn.addEventListener("click",(()=>this.togglePlay())),this.video.addEventListener("click",(()=>this.togglePlayWithEffect())),this.video.addEventListener("mouseenter",(()=>this.startHoverPreview())),this.video.addEventListener("mouseleave",(()=>this.stopHoverPreview())),this.thumbnailOverlay&&(this.thumbnailOverlay.addEventListener("mouseenter",(()=>this.startHoverPreview())),this.thumbnailOverlay.addEventListener("mouseleave",(()=>this.stopHoverPreview()))),this.volumeBtn.addEventListener("click",(()=>this.toggleMute())),this.volumeSlider.addEventListener("click",(e=>this.setVolume(e))),this.volumeSlider.addEventListener("mousedown",(e=>{e.preventDefault(),this.isVolumeDragging=!0,this.setVolume(e)})),document.addEventListener("mousemove",(e=>{this.isVolumeDragging&&!this.volumeUpdatePending&&(this.volumeUpdatePending=!0,requestAnimationFrame((()=>{this.setVolume(e),this.volumeUpdatePending=!1})))})),document.addEventListener("mouseup",(()=>{this.isVolumeDragging=!1,this.volumeUpdatePending=!1})),this.video.addEventListener("timeupdate",(()=>this.updateProgress())),this.progressContainer.addEventListener("click",(e=>this.seek(e))),this.progressContainer.addEventListener("mousemove",(e=>this.handleHover(e))),this.progressContainer.addEventListener("mouseenter",(()=>{this.thumbnailPreview&&(this.previewContainer.style.opacity="1")})),this.progressContainer.addEventListener("mouseleave",(()=>{this.previewContainer.style.opacity="0",this.isGeneratingPreview=!1})),this.progressHandle.addEventListener("mousedown",(e=>{this.isDragging=!0,e.preventDefault()})),document.addEventListener("mousemove",(e=>{this.isDragging&&this.handleDrag(e)})),document.addEventListener("mouseup",(()=>{this.isDragging&&(this.isDragging=!1,this.seekToHoverTime())})),this.pipBtn.addEventListener("click",(()=>this.togglePictureInPicture())),this.theaterBtn.addEventListener("click",(()=>this.toggleTheaterMode())),this.fullscreenBtn.addEventListener("click",(()=>this.toggleFullscreen())),this.loopBtn.addEventListener("click",(()=>this.toggleLoop())),this.speedSelector.addEventListener("change",(e=>{this.changePlaybackSpeed(e.target.value),e.target.style.transform="scale(0.95)",setTimeout((()=>{e.target.style.transform=""}),150)})),this.qualitySelector.addEventListener("change",(e=>{this.changeQuality(e.target.value),e.target.style.transform="scale(0.95)",setTimeout((()=>{e.target.style.transform=""}),150)})),this.subtitleSelector&&this.subtitleSelector.addEventListener("change",(e=>{this.changeSubtitle(e.target.value),e.target.style.transform="scale(0.95)",setTimeout((()=>{e.target.style.transform=""}),150)})),this.video.addEventListener("loadstart",(()=>{this.video.src.includes("blob:")||this.showLoadingSpinner("Loading video...")})),this.video.addEventListener("progress",(()=>{if(this.loadingSpinnerOverlay&&"flex"===this.loadingSpinnerOverlay.style.display&&this.video.buffered.length>0){const e=this.video.buffered.end(this.video.buffered.length-1),t=this.video.duration;if(t>0){const n=Math.round(e/t*100);this.updateSpinnerText(`Loading... ${n}%`)}}})),this.video.addEventListener("canplay",(()=>{this.loadingSpinnerOverlay&&"flex"===this.loadingSpinnerOverlay.style.display&&this.updateSpinnerText("Ready to play")})),this.video.addEventListener("loadeddata",(()=>{this.previewEnabled=!0,this.updateTimeDisplay(),setTimeout((()=>{this.hideLoadingSpinner()}),300),console.log("Video loaded, source:",this.video.src||this.video.currentSrc)})),this.video.addEventListener("loadedmetadata",(()=>{console.log("Video metadata loaded, ready for hover preview")})),this.video.addEventListener("error",(e=>{console.error("Video loading error:",e),this.hideLoadingSpinner()})),this.video.addEventListener("play",(()=>{this.video.muted&&!this.isVideoStarted||(this.thumbnailOverlay&&(this.thumbnailOverlay.style.display="none"),this.isVideoStarted=!0,console.log("Video officially started by user")),this.updatePlayPauseButton()})),this.video.addEventListener("pause",(()=>{this.updatePlayPauseButton()})),this.video.addEventListener("ended",(()=>{this.playPauseBtn.innerHTML='<i class="fas fa-redo"></i>',this.isVideoStarted=!1,this.video.currentTime=0,this.video.muted=!1,this.thumbnailOverlay&&this.videoConfig&&this.videoConfig.poster&&(this.thumbnailOverlay.style.display="flex",this.thumbnailOverlay.style.opacity="1",console.log("Video ended, returned to thumbnail preview state"))})),document.addEventListener("fullscreenchange",(()=>{setTimeout((()=>{this.checkVideoContainerWidth()}),100)})),document.addEventListener("webkitfullscreenchange",(()=>{setTimeout((()=>{this.checkVideoContainerWidth()}),100)})),document.addEventListener("mozfullscreenchange",(()=>{setTimeout((()=>{this.checkVideoContainerWidth()}),100)})),this.video.addEventListener("enterpictureinpicture",(()=>{this.pipBtn.classList.add("active"),this.pipBtn.innerHTML='<i class="fas fa-compress-arrows-alt"></i>'})),this.video.addEventListener("leavepictureinpicture",(()=>{this.pipBtn.classList.remove("active"),this.pipBtn.innerHTML='<i class="fas fa-external-link-alt"></i>'})),document.addEventListener("keydown",(e=>{if(document.activeElement.closest(".video-player-container")||this.playerContainer.classList.contains("theater-mode"))switch(e.code){case"KeyT":e.preventDefault(),this.toggleTheaterMode();break;case"Escape":this.playerContainer.classList.contains("theater-mode")&&(e.preventDefault(),this.exitTheaterMode())}})),this.video.volume=1,this.lastVolume=1,this.updateVolumeLevel(1),this.updateVolumeIcon(1),this.loop&&this.loopBtn.classList.add("active"),this.menuToggleBtn&&this.menuToggleBtn.addEventListener("click",(()=>this.toggleMobileMenu())),this.thumbnailOverlay&&this.thumbnailPlayBtn&&(this.thumbnailPlayBtn.addEventListener("click",(()=>this.startVideoFromThumbnail())),this.thumbnailOverlay.addEventListener("click",(e=>{e.target===this.thumbnailOverlay&&this.startVideoFromThumbnail()}))),this.mobileSpeedSelector&&this.mobileSpeedSelector.addEventListener("change",(e=>{this.changePlaybackSpeed(e.target.value),this.speedSelector.value=e.target.value})),this.mobileQualitySelector&&this.mobileQualitySelector.addEventListener("change",(e=>{this.changeQuality(e.target.value),this.qualitySelector.value=e.target.value})),this.mobileSubtitleSelector&&this.mobileSubtitleSelector.addEventListener("change",(e=>{this.changeSubtitle(e.target.value),this.subtitleSelector.value=e.target.value})),this.mobileLoopBtn&&this.mobileLoopBtn.addEventListener("click",(()=>{this.toggleLoop(),this.syncMobileButtonState("loop")})),this.mobilePipBtn&&this.mobilePipBtn.addEventListener("click",(()=>{this.togglePictureInPicture(),this.hideMobileMenu()})),this.mobileTheaterBtn&&this.mobileTheaterBtn.addEventListener("click",(()=>{this.toggleTheaterMode(),this.syncMobileButtonState("theater")})),this.mobileFullscreenBtn&&this.mobileFullscreenBtn.addEventListener("click",(()=>{this.toggleFullscreen(),this.hideMobileMenu()})),this.speedSelector?.addEventListener("change",(e=>{this.mobileSpeedSelector&&(this.mobileSpeedSelector.value=e.target.value)})),this.qualitySelector?.addEventListener("change",(e=>{this.mobileQualitySelector&&(this.mobileQualitySelector.value=e.target.value)})),this.subtitleSelector&&this.subtitleSelector.addEventListener("change",(e=>{this.mobileSubtitleSelector&&(this.mobileSubtitleSelector.value=e.target.value)})),document.addEventListener("click",(e=>{this.mobileControlsMenu&&this.mobileControlsMenu.classList.contains("show")&&(this.mobileControlsMenu.contains(e.target)||this.menuToggleBtn.contains(e.target)||this.hideMobileMenu())}))}startVideoFromThumbnail(){this.thumbnailOverlay&&(this.hoverPreviewTimeout&&(clearTimeout(this.hoverPreviewTimeout),this.hoverPreviewTimeout=null),this.isVideoStarted=!0,this.thumbnailOverlay.style.display="none",this.video.muted=!1,this.video.volume=this.originalVolume||1,this.video.currentTime=0,console.log("Starting video from thumbnail - official playback"),this.video.play().then((()=>{this.playPauseBtn.innerHTML='<i class="fas fa-pause"></i>'})).catch((e=>{console.error("Error playing video:",e),this.thumbnailOverlay.style.display="flex",this.isVideoStarted=!1})))}updatePlayPauseButton(){this.video.paused?this.playPauseBtn.innerHTML='<i class="fas fa-play"></i>':this.playPauseBtn.innerHTML='<i class="fas fa-pause"></i>'}startHoverPreview(){if(this.isVideoStarted)return;if(!this.thumbnailOverlay||"none"===this.thumbnailOverlay.style.display)return;const e=this.video.src||this.video.currentSrc&&""!==this.video.currentSrc;e?(this.hoverPreviewTimeout&&clearTimeout(this.hoverPreviewTimeout),this.hoverPreviewTimeout=setTimeout((()=>{if(!this.isVideoStarted&&e){this.originalVolume=this.video.volume||1,this.video.muted=!0;const e=()=>{this.video.play().then((()=>{console.log("Hover preview started successfully"),this.thumbnailOverlay&&(this.thumbnailOverlay.style.opacity="0.3")})).catch((t=>{console.log("Hover preview autoplay blocked or failed:",t),0===this.video.readyState&&(this.video.load(),this.video.addEventListener("loadeddata",e,{once:!0}))}))};e()}}),200)):console.log("No video source available for hover preview")}stopHoverPreview(){this.hoverPreviewTimeout&&(clearTimeout(this.hoverPreviewTimeout),this.hoverPreviewTimeout=null),this.isVideoStarted||(this.video.paused||(this.video.pause(),this.video.currentTime=0,console.log("Hover preview stopped and reset")),this.video.volume=this.originalVolume||1,this.video.muted=!1,this.thumbnailOverlay&&(this.thumbnailOverlay.style.opacity="1",this.thumbnailOverlay.style.display="flex",console.log("Returned to thumbnail preview state")))}checkVideoContainerWidth(){const e=this.video.clientWidth<780,t=this.container.classList.contains("theater-mode"),n=document.fullscreenElement===this.container,i=t||n,o=this.container.querySelectorAll(".desktop-controls"),s=this.container.querySelector(".mobile-menu-toggle");o.forEach((t=>{t.style.display=e&&!i?"none":"flex"})),s&&(s.style.display=e&&!i?"flex":"none"),e&&!i?this.container.classList.add("mobile-view"):(this.container.classList.remove("mobile-view"),this.mobileControlsMenu&&this.mobileControlsMenu.classList.contains("show")&&this.hideMobileMenu())}togglePlay(){this.video.paused?(this.video.play(),this.playPauseBtn.innerHTML='<i class="fas fa-pause"></i>'):(this.video.pause(),this.playPauseBtn.innerHTML='<i class="fas fa-play"></i>')}togglePlayWithEffect(){if(this.thumbnailOverlay&&"none"!==this.thumbnailOverlay.style.display)return void this.startVideoFromThumbnail();const e=this.video.paused?"fa-play":"fa-pause";this.videoClickOverlay&&(this.videoClickOverlay.querySelector("i").className=`fas ${e}`,this.videoClickOverlay.classList.remove("show"),this.videoClickOverlay.offsetWidth,this.videoClickOverlay.classList.add("show"),setTimeout((()=>{this.videoClickOverlay.classList.remove("show")}),800)),this.togglePlay()}toggleMute(){0===this.video.volume?(this.video.volume=this.lastVolume,this.updateVolumeIcon(this.lastVolume),this.updateVolumeLevel(this.lastVolume)):(this.lastVolume=this.video.volume,this.video.volume=0,this.volumeBtn.innerHTML='<i class="fas fa-volume-mute"></i>',this.updateVolumeLevel(0))}setVolume(e){if(!this.volumeSlider)return;const t=this.volumeSlider.getBoundingClientRect(),n=Math.min(Math.max((e.clientX-t.left)/t.width,0),1);Math.abs(this.video.volume-n)<.01||(this.video.volume=n,this.updateVolumeLevel(n),this.updateVolumeIcon(n),n>0&&(this.lastVolume=n))}updateVolumeIcon(e){if(!this.volumeBtn)return;let t;t=0===e?"fa-volume-mute":e<.5?"fa-volume-down":"fa-volume-up";const n=this.volumeBtn.querySelector("i");n&&!n.classList.contains(t)&&(this.volumeBtn.innerHTML=`<i class="fas ${t}"></i>`)}updateVolumeLevel(e){if(!this.volumeLevel)return;const t=Math.round(100*e);this.volumeLevel.style.width=`${t}%`,e>0&&(this.lastVolume=e)}updateProgress(){if(this.video.duration&&!this.isDragging){const e=this.video.currentTime/this.video.duration*100;this.progressBar.style.width=`${e}%`,this.progressHandle.style.left=`${e}%`,this.updateTimeDisplay()}}updateTimeDisplay(){const e=`${this.formatTime(this.video.currentTime)} / ${this.formatTime(this.video.duration||0)}`;this.timeDisplay&&(this.timeDisplay.textContent=e),this.mobileTimeDisplay&&(this.mobileTimeDisplay.textContent=e)}formatTime(e){if(isNaN(e))return"0:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n<10?"0":""}${n}`}getCurrentQuality(){return this.currentQuality}seek(e){const t=this.progressContainer.getBoundingClientRect(),n=Math.min(Math.max((e.clientX-t.left)/t.width,0),1)*(this.video.duration||0);if(Math.abs(n-this.video.currentTime)>5){this.showLoadingSpinner("Seeking...");const e=()=>{setTimeout((()=>{this.hideLoadingSpinner()}),200),this.video.removeEventListener("seeked",e)};this.video.addEventListener("seeked",e)}this.video.currentTime=n}handleDrag(e){const t=this.progressContainer.getBoundingClientRect(),n=Math.min(Math.max((e.clientX-t.left)/t.width,0),1),i=n*(this.video.duration||0);this.currentHoverTime=i,this.previewContainer.style.left=100*n+"%",this.previewTime.textContent=this.formatTime(i),this.progressBar.style.width=100*n+"%",this.progressHandle.style.left=100*n+"%",this.previewEnabled&&this.video.duration&&this.generatePreviewThumbnail(i)}seekToHoverTime(){this.isDragging&&(this.video.currentTime=this.currentHoverTime)}handleHover(e){const t=this.progressContainer.getBoundingClientRect(),n=Math.min(Math.max((e.clientX-t.left)/t.width,0),1),i=n*(this.video.duration||0);if(!(Math.abs(i-this.lastPreviewTime)<1)&&(this.currentHoverTime=i,this.lastPreviewTime=i,this.thumbnailPreview)){if(this.previewContainer.style.left=100*n+"%",this.previewTime.textContent=this.formatTime(i),!this.thumbnailPreview)return this.previewContainer.style.opacity="0",void(this.previewContainer.style.visibility="hidden");this.previewThrottle&&clearTimeout(this.previewThrottle),this.previewThrottle=setTimeout((()=>{this.previewEnabled&&this.thumbnailPreview&&this.video.duration&&!this.isGeneratingPreview&&(this.isGeneratingPreview=!0,this.generatePreviewThumbnail(i))}),50)}}generatePreviewThumbnail(e){if(!this.video.src||!e||!this.thumbnailPreview)return void(this.isGeneratingPreview=!1);const t=this.previewContainer.querySelector(".preview-canvas");if(!t)return void(this.isGeneratingPreview=!1);const n=t.getContext("2d");t.width=160,t.height=90;const i=this.video.currentTime,o=!this.video.paused,s=this.video.paused;s||this.video.pause(),this.video.currentTime=e;const r=()=>{try{if(n.fillStyle="#2a2a2a",n.fillRect(0,0,t.width,t.height),this.video.readyState>=2&&this.video.videoWidth>0){n.drawImage(this.video,0,0,t.width,t.height);const e=n.createLinearGradient(0,t.height-15,0,t.height);e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 0.2)"),n.fillStyle=e,n.fillRect(0,t.height-15,t.width,15)}else n.fillStyle="#444",n.fillRect(0,0,t.width,t.height),n.fillStyle="white",n.font="14px Arial",n.textAlign="center",n.fillText("Loading...",t.width/2,t.height/2)}catch(e){console.log("Preview generation failed:",e),n.fillStyle="#2a2a2a",n.fillRect(0,0,t.width,t.height),n.fillStyle="white",n.font="16px Arial",n.textAlign="center",n.fillText("",t.width/2,t.height/2)}setTimeout((()=>{this.video.currentTime=i,!s&&o&&this.video.play().catch((()=>{})),this.isGeneratingPreview=!1}),50)},a=()=>{r(),this.video.removeEventListener("seeked",a)};Math.abs(this.video.currentTime-e)<.1?r():(this.video.addEventListener("seeked",a,{once:!0}),setTimeout((()=>{this.isGeneratingPreview&&(this.video.removeEventListener("seeked",a),r())}),200))}restoreVideoState(e,t){this.video.currentTime=e,t&&setTimeout((()=>{this.video.paused&&this.video.play().catch((e=>{console.log("Playback restoration failed:",e)}))}),50)}async togglePictureInPicture(){try{document.pictureInPictureElement?(await document.exitPictureInPicture(),this.pipBtn.classList.remove("active"),this.pipBtn.innerHTML='<i class="fas fa-external-link-alt"></i>'):this.video.readyState>=2?(await this.video.requestPictureInPicture(),this.pipBtn.classList.add("active"),this.pipBtn.innerHTML='<i class="fas fa-compress-arrows-alt"></i>'):console.log("Video not ready for Picture-in-Picture")}catch(e){console.error("Picture-in-Picture error:",e),"NotSupportedError"===e.name&&alert("Picture-in-Picture is not supported in this browser.")}}toggleTheaterMode(){this.playerContainer.classList.contains("theater-mode")?this.exitTheaterMode():this.enterTheaterMode()}enterTheaterMode(){this.originalParent=this.playerContainer.parentElement,this.originalPosition={position:this.playerContainer.style.position,top:this.playerContainer.style.top,left:this.playerContainer.style.left,right:this.playerContainer.style.right,bottom:this.playerContainer.style.bottom,width:this.playerContainer.style.width,height:this.playerContainer.style.height,zIndex:this.playerContainer.style.zIndex,borderRadius:this.playerContainer.style.borderRadius,maxWidth:this.playerContainer.style.maxWidth,maxHeight:this.playerContainer.style.maxHeight},this.originalBodyOverflow=document.body.style.overflow||getComputedStyle(document.body).overflow,this.originalBodyOverflow&&"visible"!==this.originalBodyOverflow||(this.originalBodyOverflow="auto"),this.playerContainer.classList.add("theater-mode"),this.theaterBtn.classList.add("active"),this.theaterBtn.innerHTML='<i class="fas fa-compress-alt"></i>',document.body.appendChild(this.playerContainer),document.body.style.overflow="hidden",this.theaterEscapeListener=e=>{"Escape"===e.key&&this.playerContainer.classList.contains("theater-mode")&&this.exitTheaterMode()},document.addEventListener("keydown",this.theaterEscapeListener),setTimeout((()=>{this.checkVideoContainerWidth()}),100),console.log("Entered full window theater mode")}exitTheaterMode(){this.playerContainer.classList.remove("theater-mode"),this.theaterBtn.classList.remove("active"),this.theaterBtn.innerHTML='<i class="fas fa-tv"></i>',this.originalParent&&this.originalParent.appendChild(this.playerContainer),this.originalPosition&&Object.keys(this.originalPosition).forEach((e=>{this.originalPosition[e]?this.playerContainer.style[e]=this.originalPosition[e]:this.playerContainer.style[e]=""})),this.originalBodyOverflow?document.body.style.overflow=this.originalBodyOverflow:document.body.style.overflow="auto",this.theaterEscapeListener&&(document.removeEventListener("keydown",this.theaterEscapeListener),this.theaterEscapeListener=null),setTimeout((()=>{this.checkVideoContainerWidth(),"hidden"===document.body.style.overflow&&(document.body.style.overflow="auto",console.warn("Fixed body overflow that was still set to hidden after theater mode exit"))}),100),console.log("Exited full window theater mode")}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),this.fullscreenBtn.innerHTML='<i class="fas fa-expand"></i>'):(this.playerContainer.requestFullscreen?this.playerContainer.requestFullscreen():this.playerContainer.webkitRequestFullscreen?this.playerContainer.webkitRequestFullscreen():this.playerContainer.msRequestFullscreen&&this.playerContainer.msRequestFullscreen(),this.fullscreenBtn.innerHTML='<i class="fas fa-compress"></i>'),setTimeout((()=>{this.checkVideoContainerWidth()}),100)}changePlaybackSpeed(e){const t=parseFloat(e);this.video.playbackRate=t,console.log(`Playback speed changed to: ${e}x`)}toggleLoop(){return this.loop=!this.loop,this.video.loop=this.loop,this.loop?this.loopBtn.classList.add("active"):this.loopBtn.classList.remove("active"),console.log("Loop "+(this.loop?"enabled":"disabled")),this.loop}changeQuality(e){if(console.log(`Quality changed to: ${e}`),this.showLoadingSpinner(`Switching to ${"auto"===e?"Auto Quality":e}...`),this.qualitySelector.style.opacity="0.7",this.qualitySelector.style.pointerEvents="none",this.mobileQualitySelector&&(this.mobileQualitySelector.style.opacity="0.7",this.mobileQualitySelector.style.pointerEvents="none"),"auto"!==e)this.videoConfig.source[e]?this.switchVideoSource(this.videoConfig.source[e],e):(console.warn(`Quality ${e} not available`),this.hideLoadingSpinner(),this.restoreQualitySelectorState());else{const t=this.videoConfig.default||this.getHighestQualitySource();this.switchVideoSource(t,e)}}switchVideoSource(e,t){if(!e||this.video.src.endsWith(e.split("/").pop()))return this.hideLoadingSpinner(),void this.restoreQualitySelectorState();const n=this.video.currentTime,i=!this.video.paused,o=this.video.volume,s=this.video.playbackRate;this.updateSpinnerText("Buffering new quality..."),i&&this.video.pause(),this.video.src=e,this.currentQuality=t;const r=()=>{this.updateSpinnerText("Loading video...")},a=()=>{if(this.video.buffered.length>0){const e=this.video.buffered.end(this.video.buffered.length-1),t=this.video.duration;if(t>0){const n=Math.round(e/t*100);this.updateSpinnerText(`Buffering... ${n}%`)}}},l=()=>{this.updateSpinnerText("Almost ready...")},d=()=>{this.video.currentTime=n,this.video.volume=o,this.video.playbackRate=s,i&&this.video.play().catch((e=>{console.log("Playback restoration failed:",e)})),this.video.removeEventListener("loadstart",r),this.video.removeEventListener("progress",a),this.video.removeEventListener("canplay",l),this.video.removeEventListener("loadeddata",d),this.video.removeEventListener("error",c),setTimeout((()=>{this.hideLoadingSpinner(),this.restoreQualitySelectorState()}),500)},c=e=>{console.error("Error loading video:",e),this.hideLoadingSpinner(),this.restoreQualitySelectorState(),this.video.removeEventListener("loadstart",r),this.video.removeEventListener("progress",a),this.video.removeEventListener("canplay",l),this.video.removeEventListener("loadeddata",d),this.video.removeEventListener("error",c)};this.video.addEventListener("loadstart",r),this.video.addEventListener("progress",a),this.video.addEventListener("canplay",l),this.video.addEventListener("loadeddata",d),this.video.addEventListener("error",c),this.video.load(),console.log(`Switching to ${t} quality at ${this.formatTime(n)}`)}changeSubtitle(e){console.log(`Subtitle changed to: ${e}`),this.subtitleSelector&&(this.subtitleSelector.style.opacity="0.7",this.subtitleSelector.style.pointerEvents="none"),this.currentSubtitle=e;const t=this.video.textTracks;for(let e=0;e<t.length;e++)t[e].mode="disabled";if("off"!==e){for(let n=0;n<t.length;n++)if(t[n].language===e){t[n].mode="showing",console.log(`Enabled subtitle track: ${t[n].label}`);break}}else console.log("Subtitles disabled");this.subtitleSelector&&setTimeout((()=>{this.subtitleSelector.style.opacity="",this.subtitleSelector.style.pointerEvents=""}),300)}addSubtitleTrack(e){const t=document.createElement("track");t.kind=e.kind||"subtitles",t.src=e.src,t.srclang=e.srclang,t.label=e.label,e.default&&(t.default=!0),this.video.appendChild(t),this.subtitleConfig.tracks.push(e),this.subtitleSelector&&(this.subtitleSelector.innerHTML=this.generateSubtitleOptions()),console.log(`Added subtitle track: ${e.label}`)}removeSubtitleTrack(e){this.video.querySelectorAll("track").forEach((t=>{t.srclang===e&&t.remove()})),this.subtitleConfig.tracks=this.subtitleConfig.tracks.filter((t=>t.srclang!==e)),this.subtitleSelector&&(this.subtitleSelector.innerHTML=this.generateSubtitleOptions()),console.log(`Removed subtitle track: ${e}`)}toggleSubtitles(){if(this.subtitlesEnabled=!this.subtitlesEnabled,this.subtitlesEnabled)"off"!==this.currentSubtitle&&this.changeSubtitle(this.currentSubtitle),console.log("Subtitles enabled");else{const e=this.video.textTracks;for(let t=0;t<e.length;t++)e[t].mode="disabled";this.subtitleSelector&&(this.subtitleSelector.value="off"),console.log("Subtitles disabled")}return this.subtitlesEnabled}getCurrentSubtitle(){return{language:this.currentSubtitle,enabled:this.subtitlesEnabled,availableTracks:this.subtitleConfig.tracks.map((e=>({language:e.srclang,label:e.label,kind:e.kind})))}}updateSubtitleConfig(e){this.subtitleConfig={...this.subtitleConfig,...e};this.video.querySelectorAll("track").forEach((e=>e.remove())),this.subtitleConfig.enabled&&this.subtitleConfig.tracks.length>0&&this.subtitleConfig.tracks.forEach((e=>{const t=document.createElement("track");t.kind=e.kind||"subtitles",t.src=e.src,t.srclang=e.srclang,t.label=e.label,e.default&&(t.default=!0),this.video.appendChild(t)})),this.subtitleSelector&&(this.subtitleSelector.innerHTML=this.generateSubtitleOptions()),console.log("Subtitle configuration updated:",this.subtitleConfig)}async initializeDRM(){if(this.drmConfig.enabled){console.log("Initializing DRM support...");try{if(!navigator.requestMediaKeySystemAccess)throw new Error("Encrypted Media Extensions (EME) not supported");await this.requestKeySystemAccess(),this.setupDRMEventListeners(),console.log("DRM initialization successful")}catch(e){console.error("DRM initialization failed:",e),this.showDRMError(e.message)}}else console.log("DRM is disabled")}async requestKeySystemAccess(){const e=this.getKeySystemConfigs();for(const t of e)try{return console.log(`Trying key system: ${t.keySystem}`),this.keySystemAccess=await navigator.requestMediaKeySystemAccess(t.keySystem,t.configurations),console.log(`Key system access granted for: ${t.keySystem}`),this.mediaKeys=await this.keySystemAccess.createMediaKeys(),await this.video.setMediaKeys(this.mediaKeys),void console.log("Media keys set successfully")}catch(e){console.log(`Failed to get access for ${t.keySystem}:`,e.message)}throw new Error("No supported DRM system found")}getKeySystemConfigs(){const e=[];return this.drmConfig.widevine&&this.drmConfig.widevine.licenseUrl&&e.push({keySystem:"com.widevine.alpha",configurations:[{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_DECODE"}]}]}),this.drmConfig.playready&&this.drmConfig.playready.licenseUrl&&e.push({keySystem:"com.microsoft.playready",configurations:[{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_DECODE"}]}]}),this.drmConfig.fairplay&&this.drmConfig.fairplay.licenseUrl&&e.push({keySystem:"com.apple.fps.1_0",configurations:[{initDataTypes:["skd"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"',robustness:""}],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:""}]}]}),e}setupDRMEventListeners(){this.video.addEventListener("encrypted",(e=>{console.log("Encrypted media detected, generating license request..."),this.handleEncryptedMedia(e)})),this.video.addEventListener("keystatuseschange",(e=>{console.log("Key status changed:",e),this.handleKeyStatusChange(e)}))}async handleEncryptedMedia(e){try{const t=this.mediaKeys.createSession();t.addEventListener("message",(e=>{this.handleLicenseMessage(e,t)})),await t.generateRequest(e.initDataType,e.initData)}catch(e){console.error("Failed to handle encrypted media:",e),this.showDRMError("License acquisition failed")}}async handleLicenseMessage(e,t){try{const n=e.message,i=this.getLicenseUrl();if(!i)throw new Error("No license URL configured");console.log("Requesting license from:",i);const o={method:"POST",headers:{"Content-Type":"application/octet-stream",...this.getLicenseHeaders()},body:n};this.shouldUseCredentials()&&(o.credentials="include");const s=await fetch(i,o);if(!s.ok)throw new Error(`License request failed: ${s.status}`);const r=await s.arrayBuffer();await t.update(r),console.log("License applied successfully")}catch(e){console.error("License request failed:",e),this.showDRMError("Failed to acquire license")}}handleKeyStatusChange(e){e.target.keyStatuses.forEach(((e,t)=>{switch(console.log(`Key status: ${e}`),e){case"expired":console.warn("DRM key expired"),this.showDRMError("Content license expired");break;case"internal-error":console.error("DRM internal error"),this.showDRMError("DRM system error");break;case"output-restricted":console.warn("Output restricted by DRM"),this.showDRMError("Output restricted by content policy")}}))}getLicenseUrl(){if(this.keySystemAccess){const e=this.keySystemAccess.keySystem;if(e.includes("widevine"))return this.drmConfig.widevine?.licenseUrl;if(e.includes("playready"))return this.drmConfig.playready?.licenseUrl;if(e.includes("fairplay"))return this.drmConfig.fairplay?.licenseUrl}return null}getLicenseHeaders(){if(this.keySystemAccess){const e=this.keySystemAccess.keySystem;if(e.includes("widevine"))return this.drmConfig.widevine?.headers||{};if(e.includes("playready"))return this.drmConfig.playready?.headers||{};if(e.includes("fairplay"))return this.drmConfig.fairplay?.headers||{}}return{}}shouldUseCredentials(){if(this.keySystemAccess){const e=this.keySystemAccess.keySystem;if(e.includes("widevine"))return this.drmConfig.widevine?.withCredentials||!1;if(e.includes("playready"))return this.drmConfig.playready?.withCredentials||!1;if(e.includes("fairplay"))return this.drmConfig.fairplay?.withCredentials||!1}return!1}showDRMError(e){const t=document.createElement("div");t.className="drm-error-overlay",t.innerHTML=`\n            <div class="drm-error-content">\n                <i class="fas fa-lock" style="font-size: 48px; color: #ff6b6b; margin-bottom: 16px;"></i>\n                <h3>DRM Error</h3>\n                <p>${e}</p>\n                <button class="drm-error-close" onclick="this.parentElement.parentElement.remove()">Close</button>\n            </div>\n        `;if(!document.querySelector("#drm-error-styles")){const e=document.createElement("style");e.id="drm-error-styles",e.textContent="\n            .drm-error-overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0, 0, 0, 0.9);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 1000;\n                backdrop-filter: blur(8px);\n            }\n            \n            .drm-error-content {\n                background: linear-gradient(135deg, #2a2a2a, #1a1a1a);\n                padding: 40px;\n                border-radius: 16px;\n                text-align: center;\n                color: white;\n                max-width: 400px;\n                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);\n            }\n            \n            .drm-error-content h3 {\n                margin: 0 0 16px 0;\n                font-size: 24px;\n                font-weight: 600;\n            }\n            \n            .drm-error-content p {\n                margin: 0 0 24px 0;\n                opacity: 0.8;\n                line-height: 1.5;\n            }\n            \n            .drm-error-close {\n                background: #ff6b6b;\n                color: white;\n                border: none;\n                padding: 12px 24px;\n                border-radius: 8px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n            \n            .drm-error-close:hover {\n                background: #ff5252;\n                transform: translateY(-2px);\n            }\n        ",document.head.appendChild(e)}this.playerContainer.appendChild(t),setTimeout((()=>{t.parentElement&&t.remove()}),1e4)}toggleMobileMenu(){if(!this.mobileControlsMenu||!this.mobileMenuBackdrop)return;this.mobileControlsMenu.classList.contains("show")?this.hideMobileMenu():this.showMobileMenu()}showMobileMenu(){this.mobileControlsMenu&&this.mobileMenuBackdrop&&(this.mobileMenuBackdrop.classList.add("show"),setTimeout((()=>{this.mobileControlsMenu.classList.add("show")}),50),this.menuToggleBtn.innerHTML='<i class="fas fa-chevron-up"></i>',document.body.style.overflow="hidden",this.syncMobileControlStates(),this.mobileMenuBackdrop.addEventListener("click",this.hideMobileMenu.bind(this)),document.addEventListener("keydown",this.handleEscapeKey.bind(this)))}hideMobileMenu(){this.mobileControlsMenu&&this.mobileMenuBackdrop&&(this.mobileControlsMenu.classList.remove("show"),this.mobileMenuBackdrop.classList.remove("show"),this.menuToggleBtn.innerHTML='<i class="fas fa-ellipsis-v"></i>',document.body.style.overflow="",this.mobileMenuBackdrop.removeEventListener("click",this.hideMobileMenu.bind(this)),document.removeEventListener("keydown",this.handleEscapeKey.bind(this)))}handleEscapeKey(e){"Escape"===e.key&&this.hideMobileMenu()}destroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeTimeout&&clearTimeout(this.resizeTimeout)}syncMobileControlStates(){this.mobileSpeedSelector&&this.speedSelector&&(this.mobileSpeedSelector.value=this.speedSelector.value),this.mobileQualitySelector&&this.qualitySelector&&(this.mobileQualitySelector.value=this.qualitySelector.value),this.mobileSubtitleSelector&&this.subtitleSelector&&(this.mobileSubtitleSelector.value=this.subtitleSelector.value),this.syncMobileButtonState("loop"),this.syncMobileButtonState("theater")}syncMobileButtonState(e){let t,n;switch(e){case"loop":t=this.loopBtn,n=this.mobileLoopBtn;break;case"theater":t=this.theaterBtn,n=this.mobileTheaterBtn}t&&n&&(t.classList.contains("active")?n.classList.add("active"):n.classList.remove("active"))}updateDRMConfig(e){this.drmConfig={...this.drmConfig,...e},console.log("DRM configuration updated:",this.drmConfig)}updateLogoConfig(e){this.videoConfig.playerLogo={...this.videoConfig.playerLogo,...e};const t=this.container.querySelector(".player-logo-dynamic");if(t&&t.remove(),this.videoConfig.playerLogo&&this.videoConfig.playerLogo.src){const e=this.generateLogoHTML();if(e){const t=document.createElement("div");t.innerHTML=e;const n=t.firstChild,i=this.container.querySelector(".video-controls");i&&i.parentNode.insertBefore(n,i)}}}getCurrentLogoConfig(){return this.videoConfig.playerLogo?{...this.videoConfig.playerLogo}:null}static async checkDRMSupport(){const e={eme:!!navigator.requestMediaKeySystemAccess,widevine:!1,playready:!1,fairplay:!1};if(!e.eme)return e;try{await navigator.requestMediaKeySystemAccess("com.widevine.alpha",[{initDataTypes:["cenc"],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"'}]}]),e.widevine=!0}catch(e){}try{await navigator.requestMediaKeySystemAccess("com.microsoft.playready",[{initDataTypes:["cenc"],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"'}]}]),e.playready=!0}catch(e){}try{await navigator.requestMediaKeySystemAccess("com.apple.fps.1_0",[{initDataTypes:["skd"],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"'}]}]),e.fairplay=!0}catch(e){}return e}showLoadingSpinner(e="Loading..."){this.loadingSpinnerOverlay&&(this.updateSpinnerText(e),this.loadingSpinnerOverlay.style.display="flex",setTimeout((()=>{this.loadingSpinnerOverlay.style.opacity="1"}),10))}hideLoadingSpinner(){this.loadingSpinnerOverlay&&(this.loadingSpinnerOverlay.style.opacity="0",setTimeout((()=>{this.loadingSpinnerOverlay.style.display="none"}),300))}updateSpinnerText(e){this.spinnerText&&(this.spinnerText.textContent=e)}restoreQualitySelectorState(){this.qualitySelector&&(this.qualitySelector.style.opacity="",this.qualitySelector.style.pointerEvents=""),this.mobileQualitySelector&&(this.mobileQualitySelector.style.opacity="",this.mobileQualitySelector.style.pointerEvents="")}cleanup(){this.hideLoadingSpinner(),this.playerContainer&&this.playerContainer.classList.contains("theater-mode")&&this.exitTheaterMode(),"hidden"===document.body.style.overflow&&(document.body.style.overflow="auto"),this.theaterEscapeListener&&(document.removeEventListener("keydown",this.theaterEscapeListener),this.theaterEscapeListener=null),console.log("Player cleanup completed")}setupAutoCleanup(){window.addEventListener("beforeunload",(()=>{this.cleanup()})),document.addEventListener("visibilitychange",(()=>{document.hidden&&this.playerContainer&&this.playerContainer.classList.contains("theater-mode")}))}}